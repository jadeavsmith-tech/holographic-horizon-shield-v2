import re

def pii_detection_scan(prompt: str, redact: bool = False) -> tuple[bool, str, str]:
    """
    Lightweight PII scanner â€” emails, phones, SSNs, credit cards
    Returns: (safe, reason, processed_prompt)
    """
    patterns = {
        "email": r"\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b",
        "phone": r"(\+?\d{1,3}[-.\s]?)?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}",
        "ssn": r"\b\d{3}-\d{2}-\d{4}\b",
        "credit_card": r"\b(?:\d{4}[-\s]?){3}\d{4}\b",
    }
    
    findings = []
    processed = prompt
    for pii_type, pattern in patterns.items():
        matches = re.findall(pattern, prompt)
        if matches:
            findings.append(f"{pii_type.replace('_', ' ').title()} ({len(matches)})")
            if redact:
                processed = re.sub(pattern, f"[REDACTED_{pii_type.upper()}]", processed)
    
    if findings:
        reason = f"PII detected: {', '.join(findings)}"
        return False, reason, processed
    
    return True, "No PII detected", processed
